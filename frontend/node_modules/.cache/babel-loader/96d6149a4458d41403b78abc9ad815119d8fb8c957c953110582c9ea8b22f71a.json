{"ast":null,"code":"import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport axios from 'axios';\nconst API_URL = 'http://localhost:3000/api';\n\n// Async thunks\nexport const loginUser = createAsyncThunk('auth/login', async ({\n  email,\n  password\n}, {\n  rejectWithValue\n}) => {\n  try {\n    const response = await axios.post(`${API_URL}/auth/login`, {\n      email,\n      password\n    });\n    localStorage.setItem('token', response.data.accessToken);\n    localStorage.setItem('refreshToken', response.data.refreshToken);\n    return response.data;\n  } catch (error) {\n    return rejectWithValue(error.response.data.message);\n  }\n});\nexport const verifyToken = createAsyncThunk('auth/verify', async (_, {\n  rejectWithValue\n}) => {\n  try {\n    const token = localStorage.getItem('token');\n    if (!token) throw new Error('No token');\n    const response = await axios.get(`${API_URL}/auth/verify`, {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    });\n    return response.data;\n  } catch (error) {\n    localStorage.removeItem('token');\n    localStorage.removeItem('refreshToken');\n    return rejectWithValue('Token invalid');\n  }\n});\nexport const logoutUser = createAsyncThunk('auth/logout', async (_, {\n  rejectWithValue\n}) => {\n  try {\n    const refreshToken = localStorage.getItem('refreshToken');\n    if (refreshToken) {\n      await axios.post(`${API_URL}/auth/logout`, {\n        refreshToken\n      });\n    }\n    localStorage.removeItem('token');\n    localStorage.removeItem('refreshToken');\n    return {};\n  } catch (error) {\n    localStorage.removeItem('token');\n    localStorage.removeItem('refreshToken');\n    return {};\n  }\n});\nconst authSlice = createSlice({\n  name: 'auth',\n  initialState: {\n    user: null,\n    token: localStorage.getItem('token'),\n    isLoading: false,\n    error: null,\n    isAuthenticated: false\n  },\n  reducers: {\n    clearError: state => {\n      state.error = null;\n    }\n  },\n  extraReducers: builder => {\n    builder\n    // Login\n    .addCase(loginUser.pending, state => {\n      state.isLoading = true;\n      state.error = null;\n    }).addCase(loginUser.fulfilled, (state, action) => {\n      state.isLoading = false;\n      state.user = action.payload.user;\n      state.token = action.payload.accessToken;\n      state.isAuthenticated = true;\n    }).addCase(loginUser.rejected, (state, action) => {\n      state.isLoading = false;\n      state.error = action.payload;\n      state.isAuthenticated = false;\n    })\n    // Verify\n    .addCase(verifyToken.fulfilled, (state, action) => {\n      state.user = action.payload.user;\n      state.isAuthenticated = true;\n    }).addCase(verifyToken.rejected, state => {\n      state.user = null;\n      state.token = null;\n      state.isAuthenticated = false;\n    })\n    // Logout\n    .addCase(logoutUser.fulfilled, state => {\n      state.user = null;\n      state.token = null;\n      state.isAuthenticated = false;\n    });\n  }\n});\nexport const {\n  clearError\n} = authSlice.actions;\nexport default authSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","axios","API_URL","loginUser","email","password","rejectWithValue","response","post","localStorage","setItem","data","accessToken","refreshToken","error","message","verifyToken","_","token","getItem","Error","get","headers","Authorization","removeItem","logoutUser","authSlice","name","initialState","user","isLoading","isAuthenticated","reducers","clearError","state","extraReducers","builder","addCase","pending","fulfilled","action","payload","rejected","actions","reducer"],"sources":["C:/PTPMMNM/Group7-project/frontend/src/store/authSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport axios from 'axios';\n\nconst API_URL = 'http://localhost:3000/api';\n\n// Async thunks\nexport const loginUser = createAsyncThunk(\n  'auth/login',\n  async ({ email, password }, { rejectWithValue }) => {\n    try {\n      const response = await axios.post(`${API_URL}/auth/login`, { email, password });\n      localStorage.setItem('token', response.data.accessToken);\n      localStorage.setItem('refreshToken', response.data.refreshToken);\n      return response.data;\n    } catch (error) {\n      return rejectWithValue(error.response.data.message);\n    }\n  }\n);\n\nexport const verifyToken = createAsyncThunk(\n  'auth/verify',\n  async (_, { rejectWithValue }) => {\n    try {\n      const token = localStorage.getItem('token');\n      if (!token) throw new Error('No token');\n      \n      const response = await axios.get(`${API_URL}/auth/verify`, {\n        headers: { Authorization: `Bearer ${token}` }\n      });\n      return response.data;\n    } catch (error) {\n      localStorage.removeItem('token');\n      localStorage.removeItem('refreshToken');\n      return rejectWithValue('Token invalid');\n    }\n  }\n);\n\nexport const logoutUser = createAsyncThunk(\n  'auth/logout',\n  async (_, { rejectWithValue }) => {\n    try {\n      const refreshToken = localStorage.getItem('refreshToken');\n      if (refreshToken) {\n        await axios.post(`${API_URL}/auth/logout`, { refreshToken });\n      }\n      localStorage.removeItem('token');\n      localStorage.removeItem('refreshToken');\n      return {};\n    } catch (error) {\n      localStorage.removeItem('token');\n      localStorage.removeItem('refreshToken');\n      return {};\n    }\n  }\n);\n\nconst authSlice = createSlice({\n  name: 'auth',\n  initialState: {\n    user: null,\n    token: localStorage.getItem('token'),\n    isLoading: false,\n    error: null,\n    isAuthenticated: false,\n  },\n  reducers: {\n    clearError: (state) => {\n      state.error = null;\n    },\n  },\n  extraReducers: (builder) => {\n    builder\n      // Login\n      .addCase(loginUser.pending, (state) => {\n        state.isLoading = true;\n        state.error = null;\n      })\n      .addCase(loginUser.fulfilled, (state, action) => {\n        state.isLoading = false;\n        state.user = action.payload.user;\n        state.token = action.payload.accessToken;\n        state.isAuthenticated = true;\n      })\n      .addCase(loginUser.rejected, (state, action) => {\n        state.isLoading = false;\n        state.error = action.payload;\n        state.isAuthenticated = false;\n      })\n      // Verify\n      .addCase(verifyToken.fulfilled, (state, action) => {\n        state.user = action.payload.user;\n        state.isAuthenticated = true;\n      })\n      .addCase(verifyToken.rejected, (state) => {\n        state.user = null;\n        state.token = null;\n        state.isAuthenticated = false;\n      })\n      // Logout\n      .addCase(logoutUser.fulfilled, (state) => {\n        state.user = null;\n        state.token = null;\n        state.isAuthenticated = false;\n      });\n  },\n});\n\nexport const { clearError } = authSlice.actions;\nexport default authSlice.reducer;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}