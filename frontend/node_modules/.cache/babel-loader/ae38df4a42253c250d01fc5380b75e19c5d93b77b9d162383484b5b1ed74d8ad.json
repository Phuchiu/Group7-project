{"ast":null,"code":"import axios from 'axios';\nconst API_BASE_URL = 'http://localhost:3001';\n\n// Create axios instance\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n  timeout: 10000\n});\n\n// Token management\nconst TokenManager = {\n  getAccessToken: () => localStorage.getItem('accessToken'),\n  getRefreshToken: () => localStorage.getItem('refreshToken'),\n  setTokens: (accessToken, refreshToken) => {\n    localStorage.setItem('accessToken', accessToken);\n    localStorage.setItem('refreshToken', refreshToken);\n  },\n  clearTokens: () => {\n    localStorage.removeItem('accessToken');\n    localStorage.removeItem('refreshToken');\n    localStorage.removeItem('user');\n  }\n};\n\n// Request interceptor - add access token\napi.interceptors.request.use(config => {\n  const token = TokenManager.getAccessToken();\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n}, error => Promise.reject(error));\n\n// Response interceptor - handle token refresh\napi.interceptors.response.use(response => response, async error => {\n  var _error$response, _originalRequest$url;\n  const originalRequest = error.config;\n\n  // Check for 401 error and avoid infinite loops\n  if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401 && !originalRequest._retry && !((_originalRequest$url = originalRequest.url) !== null && _originalRequest$url !== void 0 && _originalRequest$url.includes('/auth/refresh'))) {\n    originalRequest._retry = true;\n    try {\n      const refreshToken = TokenManager.getRefreshToken();\n      if (!refreshToken) {\n        throw new Error('No refresh token');\n      }\n      console.log('üîÑ Token expired, refreshing...');\n      const response = await axios.post(`${API_BASE_URL}/api/auth/refresh`, {\n        refreshToken\n      });\n      const {\n        accessToken\n      } = response.data;\n      TokenManager.setTokens(accessToken, refreshToken);\n      console.log('‚úÖ Token refreshed successfully');\n\n      // Retry original request with new token\n      originalRequest.headers.Authorization = `Bearer ${accessToken}`;\n      return api(originalRequest);\n    } catch (refreshError) {\n      console.log('‚ùå Refresh failed, redirecting to login');\n      TokenManager.clearTokens();\n      window.location.reload();\n      return Promise.reject(refreshError);\n    }\n  }\n  return Promise.reject(error);\n});\nexport { api, TokenManager };\nexport default api;","map":{"version":3,"names":["axios","API_BASE_URL","api","create","baseURL","timeout","TokenManager","getAccessToken","localStorage","getItem","getRefreshToken","setTokens","accessToken","refreshToken","setItem","clearTokens","removeItem","interceptors","request","use","config","token","headers","Authorization","error","Promise","reject","response","_error$response","_originalRequest$url","originalRequest","status","_retry","url","includes","Error","console","log","post","data","refreshError","window","location","reload"],"sources":["C:/PTPMMNM/Group7-project/frontend/src/services/api.js"],"sourcesContent":["import axios from 'axios';\n\nconst API_BASE_URL = 'http://localhost:3001';\n\n// Create axios instance\nconst api = axios.create({\n  baseURL: API_BASE_URL,\n  timeout: 10000\n});\n\n// Token management\nconst TokenManager = {\n  getAccessToken: () => localStorage.getItem('accessToken'),\n  getRefreshToken: () => localStorage.getItem('refreshToken'),\n  setTokens: (accessToken, refreshToken) => {\n    localStorage.setItem('accessToken', accessToken);\n    localStorage.setItem('refreshToken', refreshToken);\n  },\n  clearTokens: () => {\n    localStorage.removeItem('accessToken');\n    localStorage.removeItem('refreshToken');\n    localStorage.removeItem('user');\n  }\n};\n\n// Request interceptor - add access token\napi.interceptors.request.use(\n  (config) => {\n    const token = TokenManager.getAccessToken();\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    return config;\n  },\n  (error) => Promise.reject(error)\n);\n\n// Response interceptor - handle token refresh\napi.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    const originalRequest = error.config;\n\n    // Check for 401 error and avoid infinite loops\n    if (error.response?.status === 401 && \n        !originalRequest._retry &&\n        !originalRequest.url?.includes('/auth/refresh')) {\n      \n      originalRequest._retry = true;\n      \n      try {\n        const refreshToken = TokenManager.getRefreshToken();\n        if (!refreshToken) {\n          throw new Error('No refresh token');\n        }\n\n        console.log('üîÑ Token expired, refreshing...');\n        \n        const response = await axios.post(`${API_BASE_URL}/api/auth/refresh`, {\n          refreshToken\n        });\n\n        const { accessToken } = response.data;\n        TokenManager.setTokens(accessToken, refreshToken);\n        \n        console.log('‚úÖ Token refreshed successfully');\n        \n        // Retry original request with new token\n        originalRequest.headers.Authorization = `Bearer ${accessToken}`;\n        return api(originalRequest);\n        \n      } catch (refreshError) {\n        console.log('‚ùå Refresh failed, redirecting to login');\n        TokenManager.clearTokens();\n        window.location.reload();\n        return Promise.reject(refreshError);\n      }\n    }\n\n    return Promise.reject(error);\n  }\n);\n\nexport { api, TokenManager };\nexport default api;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}